&GLOBAL
  PROJECT water_dft
  RUN_TYPE MD             
  WALLTIME 1800
  IOLEVEL  LOW 
&END GLOBAL

&FORCE_EVAL
  METHOD Quickstep
  &DFT
    BASIS_SET_FILE_NAME BASIS_MOLOPT
    POTENTIAL_FILE_NAME GTH_POTENTIALS            

    CHARGE 0
    MULTIPLICITY 1

    &MGRID
       CUTOFF [Ry] 400 
    &END

    &QS
       METHOD GPW 
       EPS_DEFAULT 1.0E-10 
       ! used for MD, the method used to generate the initial guess.
       EXTRAPOLATION ASPC 
    &END

    &POISSON
       PERIODIC XYZ 
    &END

    ! use the OT METHOD for robust and efficient SCF, suitable for all non-metallic systems.
    &SCF                              
      SCF_GUESS ATOMIC 
      MAX_SCF 30
      EPS_SCF 1.0E-6 
      &OT
        ! an accurate preconditioner suitable also for larger systems
        PRECONDITIONER FULL_SINGLE_INVERSE
        MINIMIZER DIIS
      &END OT
      &OUTER_SCF
        MAX_SCF 10
        EPS_SCF 1.0E-6
      &END
      &PRINT
        &RESTART OFF
        &END
      &END
    &END SCF

    &XC
      &XC_FUNCTIONAL 
         &PBE
         &END
      &END XC_FUNCTIONAL
      &VDW_POTENTIAL
         POTENTIAL_TYPE PAIR_POTENTIAL 
         &PAIR_POTENTIAL
            PARAMETER_FILE_NAME dftd3.dat
            TYPE DFTD3
            REFERENCE_FUNCTIONAL PBE
            R_CUTOFF [angstrom] 16
         &END
      &END VDW_POTENTIAL
    &END XC
  &END DFT
 
  &SUBSYS
    &CELL 
      ABC [angstrom] 12.42 12.42 12.42
    &END CELL
    &TOPOLOGY
      COORD_FILE_NAME water.xyz
      COORD_FILE_FORMAT XYZ
    &END
    &KIND H                              
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE-q1             
    &END KIND
    &KIND O
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE-q6
    &END KIND
  &END SUBSYS
&END FORCE_EVAL

&MOTION
 &MD
   ENSEMBLE NVT  ! sampling the canonical ensemble
   TEMPERATURE [K] 300
   TIMESTEP [fs] 0.5
   STEPS 100
    &THERMOSTAT
      TYPE CSVR
      &CSVR
        TIMECON 200.
      &END CSVR
    &END THERMOSTAT
 &END
  &PRINT
   &TRAJECTORY
     &EACH
       MD 1
     &END EACH
   &END TRAJECTORY
   &VELOCITIES OFF
   &END VELOCITIES
   &FORCES OFF
   &END FORCES
   &RESTART_HISTORY
     &EACH
       MD 500
     &END EACH
   &END RESTART_HISTORY
  &END PRINT
&END
